<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator - Four Elementz Events</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h2, h3 {
      margin: 5px 0;
    }

    input, textarea, button {
      margin: 5px 0;
      padding: 6px;
      width: 100%;
      max-width: 400px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: fixed; /* important for PDF */
    }

    table, th, td {
      border: 1px solid #000;
    }

    th, td {
      padding: 6px;
      text-align: left;
      word-wrap: break-word; /* ensures text wonâ€™t disappear */
    }

    /* Column widths */
    th:nth-child(1), td:nth-child(1) { width: 50%; }  /* Description */
    th:nth-child(2), td:nth-child(2) { width: 15%; }  /* Qty */
    th:nth-child(3), td:nth-child(3) { width: 15%; }  /* Unit Price */
    th:nth-child(4), td:nth-child(4) { width: 20%; }  /* Total */

    #invoicePreview {
      border: 2px solid #000;
      padding: 15px;
      margin-top: 20px;
      background: #fff;
    }

    #downloadBtn {
      margin-top: 20px;
      padding: 10px 15px;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    #downloadBtn:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <h2>Invoice Generator - Four Elementz Events</h2>

  <label>Company Name:</label>
  <input id="companyName" value="Four Elementz Events">

  <label>Company Address:</label>
  <textarea id="companyAddress" rows="3">No. 10, Event Street, Colombo
Phone: 011-1234567
Email: info@fourelementzevents.com</textarea>

  <label>Customer Name:</label>
  <input id="customerName" placeholder="Enter customer name">

  <label>Invoice Number:</label>
  <input id="invoiceNo" placeholder="INV001">

  <label>Date:</label>
  <input id="invoiceDate" type="date">

  <h3>Invoice Items</h3>
  <table id="itemsTable">
    <tr>
      <th>Description</th>
      <th>Qty</th>
      <th>Unit Price</th>
      <th>Total</th>
    </tr>
  </table>
  <button onclick="addItem()">Add Item</button>

  <h3>Preview</h3>
  <div id="invoicePreview"></div>

  <button id="downloadBtn">Download PDF</button>

  <script>
    const itemsTable = document.getElementById('itemsTable');
    const previewDiv = document.getElementById('invoicePreview');
    const downloadBtn = document.getElementById('downloadBtn');

    function addItem() {
      const row = itemsTable.insertRow(-1);
      const desc = row.insertCell(0);
      const qty = row.insertCell(1);
      const price = row.insertCell(2);
      const total = row.insertCell(3);

      desc.innerHTML = `<input type="text" placeholder="Description">`;
      qty.innerHTML = `<input type="number" value="1" min="1">`;
      price.innerHTML = `<input type="number" value="0" min="0">`;
      total.innerHTML = `0`;

      row.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', updateTotals);
      });
    }

    function updateTotals() {
      for (let i = 1; i < itemsTable.rows.length; i++) {
        const row = itemsTable.rows[i];
        const qty = row.cells[1].querySelector('input').value || 0;
        const price = row.cells[2].querySelector('input').value || 0;
        const total = qty * price;
        row.cells[3].innerText = total.toFixed(2);
      }
      renderPreview();
    }

    function renderPreview() {
      let html = `
        <h2>${document.getElementById('companyName').value}</h2>
        <p>${document.getElementById('companyAddress').value.replace(/\n/g, '<br>')}</p>
        <hr>
        <p><strong>Bill To:</strong> ${document.getElementById('customerName').value}</p>
        <p><strong>Invoice No:</strong> ${document.getElementById('invoiceNo').value}</p>
        <p><strong>Date:</strong> ${document.getElementById('invoiceDate').value}</p>
        <table>
          <tr>
            <th>Description</th>
            <th>Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>`;
      
      let grandTotal = 0;
      for (let i = 1; i < itemsTable.rows.length; i++) {
        const row = itemsTable.rows[i];
        const desc = row.cells[0].querySelector('input').value;
        const qty = row.cells[1].querySelector('input').value;
        const price = row.cells[2].querySelector('input').value;
        const total = row.cells[3].innerText;
        html += `<tr>
                  <td>${desc}</td>
                  <td>${qty}</td>
                  <td>${price}</td>
                  <td>${total}</td>
                 </tr>`;
        grandTotal += parseFloat(total);
      }

      html += `<tr>
                <td colspan="3"><strong>Grand Total</strong></td>
                <td><strong>${grandTotal.toFixed(2)}</strong></td>
               </tr></table>`;
      previewDiv.innerHTML = html;
    }

    downloadBtn.addEventListener('click', () => {
      renderPreview(); // ensure preview is up-to-date
      const opt = {
        margin: 10,
        filename: `${document.getElementById('invoiceNo').value || 'invoice'}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(previewDiv).save();
    });
  </script>
</body>
</html>
