<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EventPlan — Invoice Generator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.css">
  <style>
    :root{--accent:#2b6cb0;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#111;margin:0;padding:24px;background:#f7fafc}
    .container{max-width:1000px;margin:0 auto}
    h1{margin:0 0 12px;font-size:20px}
    .grid{display:grid;gap:12px}
    .row{display:flex;gap:12px}
    input,select,textarea{padding:8px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .card{background:white;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(7,10,20,0.06)}
    .flex{display:flex;gap:12px;align-items:center}
    .spacer{flex:1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eef2f7;font-size:14px}
    th{background:#f1f5f9;text-align:left}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid #cfe3ff}
    .muted{color:var(--muted)}
    .invoice-preview{background:white;padding:20px;border-radius:8px}
    .invoice-head{display:flex;justify-content:space-between;align-items:flex-start}
    .invoice-meta{font-size:13px;color:var(--muted)}
    .right{text-align:right}
    .totals{margin-top:12px}
    .totals .line{display:flex;justify-content:space-between;padding:6px 0}
    .small{font-size:13px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .danger{background:#ef4444}
    footer{margin-top:18px;font-size:13px;color:var(--muted)}
    @media (min-width:900px){.grid-2{grid-template-columns:1fr 420px}}
    @media (max-width:899px){.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <h1>EventPlan — Invoice Generator</h1>
    <p class="muted">Create an invoice and download it as PDF. Designed for an event planning company — host this single file on GitHub Pages.</p>

    <div class="grid grid-2" style="margin-top:12px;gap:16px">
      <div class="card">
        <h2 style="margin-top:0">Invoice details</h2>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:180px">
            <label>Company name</label>
            <input id="companyName" value="Four Elementz Events" />

          </div>
          <div style="min-width:140px">
            <label>Invoice #</label>
            <input id="invoiceNo" value="INV-001" />
          </div>
          <div style="min-width:160px">
            <label>Date</label>
            <input id="invoiceDate" type="date" />
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <div style="flex:1">
            <label>Bill to (Customer)</label>
            <input id="customerName" placeholder="Customer name" />
            <textarea id="customerAddress" rows="3" placeholder="Customer address" style="margin-top:6px"></textarea>
          </div>

          <div style="width:220px">
            <label>Company Address</label>
            <textarea id="companyAddress" rows="3">Pannipitiya,Colombo
Phone: 0712871830
Email: fourelementzevents@gmail.com</textarea>
          </div>
        </div>

        <div style="margin-top:12px">
          <label>Notes (appears on invoice)</label>
          <textarea id="notes" rows="3">Thank you for choosing EventPlan. Please pay within 14 days.</textarea>
        </div>

        <section style="margin-top:12px">
          <h3 style="margin:0 0 8px">Items</h3>
          <table id="itemsTable">
            <thead>
              <tr><th style="width:44%">Description</th><th style="width:14%">Qty</th><th style="width:18%">Unit price</th><th style="width:16%">Tax (%)</th><th style="width:8%"></th></tr>
            </thead>
            <tbody id="itemsBody"></tbody>
          </table>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="addItem" class="btn">+ Add item</button>
            <button id="clearItems" class="btn ghost">Clear items</button>
          </div>
        </section>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <label style="margin:0">Discount (fixed)</label>
          <input id="discount" type="number" value="0" style="width:120px" />
          <label style="margin:0">Currency</label>
          <select id="currency"><option value="LKR">LKR</option><option value="USD">USD</option><option value="EUR">EUR</option></select>
          <div class="spacer"></div>
          <button id="previewBtn" class="btn">Show preview</button>
          <button id="downloadBtn" class="btn">Download PDF</button>
        </div>

        <footer>
          <strong>Note:</strong> This file is ready to host on GitHub Pages — upload as <code>index.html</code> to a repo and enable Pages.
        </footer>
      </div>

      <aside>
        <div class="card">
          <h2 style="margin-top:0">Preview</h2>
          <div id="preview" class="invoice-preview small">
            <!-- invoice preview rendered here -->
            <div style="text-align:center;opacity:0.65">Click "Show preview" to render the invoice here.</div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h3 style="margin-top:0">Quick actions</h3>
          <div class="controls">
            <button id="saveJSON" class="btn ghost">Save JSON</button>
            <button id="loadJSON" class="btn ghost">Load JSON</button>
            <button id="resetForm" class="btn ghost">Reset</button>
          </div>
          <p class="muted small" style="margin-top:8px">Saved JSON will use localStorage in your browser (for sharing, copy the JSON text and paste into another browser).</p>
        </div>
      </aside>
    </div>
  </div>

  <!-- libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    // Basic invoice generator script
    const itemsBody = document.getElementById('itemsBody');
    const addItemBtn = document.getElementById('addItem');
    const clearItemsBtn = document.getElementById('clearItems');
    const previewBtn = document.getElementById('previewBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const previewDiv = document.getElementById('preview');
    const saveJSONBtn = document.getElementById('saveJSON');
    const loadJSONBtn = document.getElementById('loadJSON');
    const resetFormBtn = document.getElementById('resetForm');

    // default date to today
    document.getElementById('invoiceDate').valueAsDate = new Date();

    function createItemRow(item={desc:'Setup fee', qty:1, price:5000, tax:0}){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input class="desc" value="${escapeHtml(item.desc)}" style="width:100%" /></td>
        <td><input class="qty" type="number" min="0" value="${item.qty}" style="width:80px" /></td>
        <td><input class="price" type="number" min="0" value="${item.price}" style="width:120px" /></td>
        <td><input class="tax" type="number" min="0" value="${item.tax}" style="width:80px" /></td>
        <td><button class="btn ghost remove">x</button></td>
      `;
      tr.querySelector('.remove').addEventListener('click', ()=>tr.remove());
      itemsBody.appendChild(tr);
    }

    function escapeHtml(s){return (s+'').replace(/[&<>"']/g, c=>({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

    addItemBtn.addEventListener('click', ()=>createItemRow({desc:'',qty:1,price:0,tax:0}));
    clearItemsBtn.addEventListener('click', ()=>{itemsBody.innerHTML='';});

    // start with two sample rows
    createItemRow({desc:'Venue booking',qty:1,price:45000,tax:0});
    createItemRow({desc:'Decoration + Setup',qty:1,price:15000,tax:0});

    function readForm(){
      const companyName = document.getElementById('companyName').value;
      const companyAddress = document.getElementById('companyAddress').value;
      const invoiceNo = document.getElementById('invoiceNo').value;
      const invoiceDate = document.getElementById('invoiceDate').value;
      const customerName = document.getElementById('customerName').value;
      const customerAddress = document.getElementById('customerAddress').value;
      const notes = document.getElementById('notes').value;
      const discount = parseFloat(document.getElementById('discount').value)||0;
      const currency = document.getElementById('currency').value;

      const rows = Array.from(itemsBody.querySelectorAll('tr')).map(tr=>({
        desc: tr.querySelector('.desc').value,
        qty: parseFloat(tr.querySelector('.qty').value)||0,
        price: parseFloat(tr.querySelector('.price').value)||0,
        tax: parseFloat(tr.querySelector('.tax').value)||0,
      }));

      return {companyName,companyAddress,invoiceNo,invoiceDate,customerName,customerAddress,notes,discount,currency,rows};
    }

    function calcTotals(rows,discount){
      let sub=0;let taxTotal=0;
      rows.forEach(r=>{const line = r.qty * r.price; sub += line; taxTotal += line * (r.tax/100);});
      const total = sub + taxTotal - discount;
      return {sub, taxTotal, discount, total};
    }

    function renderPreview(){
      const data = readForm();
      const t = calcTotals(data.rows,data.discount);

      const rowsHtml = data.rows.map(r=>{
        const line = (r.qty * r.price);
        const taxAmt = (line * (r.tax/100));
        return `<tr><td>${escapeHtml(r.desc)}</td><td class="right">${r.qty}</td><td class="right">${formatMoney(r.price,data.currency)}</td><td class="right">${formatMoney(line + taxAmt,data.currency)}</td></tr>`;
      }).join('');

      previewDiv.innerHTML = `
        <div class="invoice-head">
          <div>
            <strong style="font-size:18px">${escapeHtml(data.companyName)}</strong>
            <div class="invoice-meta">${nl2br(escapeHtml(data.companyAddress))}</div>
          </div>
          <div class="right">
            <div style="font-weight:600">Invoice</div>
            <div class="invoice-meta">No: ${escapeHtml(data.invoiceNo)}<br/>Date: ${escapeHtml(data.invoiceDate)}</div>
          </div>
        </div>

        <hr style="margin:12px 0"/>

        <div style="display:flex;justify-content:space-between;padding:6px 0">
          <div>
            <div class="small muted">Bill to</div>
            <div style="font-weight:600">${escapeHtml(data.customerName)}</div>
            <div class="invoice-meta">${nl2br(escapeHtml(data.customerAddress))}</div>
          </div>
          <div class="right">
            <div class="small muted">Currency</div>
            <div style="font-weight:600">${data.currency}</div>
          </div>
        </div>

        <table style="margin-top:8px">
          <thead><tr><th style="width:60%">Description</th><th>Qty</th><th>Unit</th><th class="right">Line total</th></tr></thead>
          <tbody>${rowsHtml}</tbody>
        </table>

        <div class="totals">
          <div class="line"><div class="muted">Sub total</div><div>${formatMoney(t.sub,data.currency)}</div></div>
          <div class="line"><div class="muted">Tax total</div><div>${formatMoney(t.taxTotal,data.currency)}</div></div>
          <div class="line"><div class="muted">Discount</div><div>-${formatMoney(t.discount,data.currency)}</div></div>
          <div class="line" style="font-weight:700;font-size:16px"><div>Total</div><div>${formatMoney(t.total,data.currency)}</div></div>
        </div>

        <div style="margin-top:12px" class="muted small">${nl2br(escapeHtml(data.notes))}</div>
      `;
    }

    function nl2br(s){return s.replace(/\n/g,'<br/>');}
    function formatMoney(v,cur){return new Intl.NumberFormat(undefined,{maximumFractionDigits:2}).format(v) + ' ' + cur}

    previewBtn.addEventListener('click', ()=>renderPreview());

    downloadBtn.addEventListener('click', ()=>{
      renderPreview();
      // prepare a printable element
      const opt = {
        margin:       10,
        filename:     `${document.getElementById('invoiceNo').value || 'invoice'}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      const element = previewDiv.cloneNode(true);
      // add company header to the top of the element for PDF
      const header = document.createElement('div'); header.style.marginBottom='12px'; header.innerHTML = `<strong>${escapeHtml(document.getElementById('companyName').value)}</strong><div class="invoice-meta">${nl2br(escapeHtml(document.getElementById('companyAddress').value))}</div>`;
      element.insertBefore(header, element.firstChild);
      // show full width
      element.style.width='800px'; element.style.background='white'; element.style.padding='20px';
      html2pdf().set(opt).from(element).save();
    });

    saveJSONBtn.addEventListener('click', ()=>{
      const data = readForm();
      localStorage.setItem('invoiceData', JSON.stringify(data));
      alert('Saved to localStorage');
    });
    loadJSONBtn.addEventListener('click', ()=>{
      const raw = localStorage.getItem('invoiceData');
      if(!raw){ alert('No saved invoice in localStorage'); return; }
      const data = JSON.parse(raw);
      document.getElementById('companyName').value = data.companyName || '';
      document.getElementById('companyAddress').value = data.companyAddress || '';
      document.getElementById('invoiceNo').value = data.invoiceNo || '';
      document.getElementById('invoiceDate').value = data.invoiceDate || '';
      document.getElementById('customerName').value = data.customerName || '';
      document.getElementById('customerAddress').value = data.customerAddress || '';
      document.getElementById('notes').value = data.notes || '';
      document.getElementById('discount').value = data.discount || 0;
      document.getElementById('currency').value = data.currency || 'LKR';
      itemsBody.innerHTML='';
      (data.rows||[]).forEach(r=>createItemRow(r));
      alert('Loaded from localStorage — click Show preview');
    });

    resetFormBtn.addEventListener('click', ()=>{
      if(!confirm('Reset form to defaults?')) return;
      document.getElementById('companyName').value='EventPlan Co.';
      document.getElementById('companyAddress').value='No 10, Flower St., Colombo\nPhone: 011-1234567\nEmail: hello@eventplan.example';
      document.getElementById('invoiceNo').value='INV-001';
      document.getElementById('invoiceDate').valueAsDate=new Date();
      document.getElementById('customerName').value='';
      document.getElementById('customerAddress').value='';
      document.getElementById('notes').value='Thank you for choosing EventPlan. Please pay within 14 days.';
      document.getElementById('discount').value=0;
      itemsBody.innerHTML='';
      createItemRow({desc:'Venue booking',qty:1,price:45000,tax:0});
      createItemRow({desc:'Decoration + Setup',qty:1,price:15000,tax:0});
    });

    // small helper: when user edits table cells, keep preview reactive
    itemsBody.addEventListener('input', ()=>{/* no-op: the user can click preview to re-render */});
  </script>
</body>
</html>
